# Shadowrocket配置文件,解决DNS泄露

[General]
ipv6 = false
bypass-system = true
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, captive.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.18.0.0/15, 224.0.0.0/4, 240.0.0.0/4

# --- DNS 优化部分 START ---
# 注释或删除国内DNS
# dns-server = 223.5.5.5, 119.29.29.29

# 启用加密DNS (DoH)，三选一或多选即可
encrypted-dns-server = https://1.1.1.1/dns-query, https://dns.google/dns-query, https://dns.quad9.net/dns-query
prefer-ipv6 = false
dns-fallback-system = false
dns-direct-system = false

[Proxy Group]
# 基础策略组
🚀 节点选择 = select,♻️ 自动选择,�🇰 香港自动,�🇹🇼 台湾自动,🇸🇬 新加坡自动,🇯🇵 日本自动,🇺🇲 美国自动,🌍 其他节点,DIRECT
🎯 全球直连 = select,DIRECT,🚀 节点选择
🛑 广告拦截 = select,REJECT,DIRECT
🐟 漏网之鱼 = select,DIRECT,🚀 节点选择

# 场景策略组
📹 YouTube = select,�🇰 香港自动,�🇸🇬 新加坡自动,🇯🇵 日本自动,🚀 节点选择
🗽 x = select,🇺� 美国自动,🌍 其他节点,♻️ 自动选择,🚀 节点选择,DIRECT
🏹 AI = select,🇺🇲 美国自动,🏠 家宽节点,�🇸🇬 新加坡自动,🇯🇵 日本自动
🍒 Microsoft = select,🇺🇲 美国自动,🇭🇰 香港自动,🚀 节点选择,DIRECT
📲 Telegram = select,🇺🇲 美国自动,�🇰 香港自动,🌍 其他节点,🚀 节点选择
🎥 Netflix = select,🇭🇰 香港自动,🇹🇼 台湾自动,🇸🇬 新加坡自动,🇯🇵 日本自动,🇺🇲 美国自动,🌍 其他节点,🚀 节点选择
🍎 Apple = select,🇺🇲 美国自动,🇭🇰 香港自动,DIRECT,🚀 节点选择
💶 PayPal = select,🇺🇲 美国自动,🇭🇰 香港自动,🚀 节点选择,DIRECT
☁️ Cloudflare = select,�🇰 香港自动,�🇹🇼 台湾自动,🇸🇬 新加坡自动,🇯🇵 日本自动,🇺🇲 美国自动,🏠 家宽节点,🚀 节点选择,DIRECT
🐬 外贸 = select,🇺🇲 美国自动,�🇰 香港自动,🌍 其他节点,🚀 节点选择
🎵 Spotify = select,�🇰 香港自动,�🇹🇼 台湾自动,🇸🇬 新加坡自动,🇯🇵 日本自动,🇺🇲 美国自动,🌍 其他节点,🚀 节点选择

# 手动选择组 - 精确过滤规则
🏠 家宽节点 = select,policy-regex-filter=^(?=.*(?i)(?:家宽))(?!.*(?i)(?:到期|过期|剩余|流量|时间|官网|产品|专线|倍率)).*$

# 自动选择组 - 精确过滤规则 {# 节点筛选}
�🇰 香港自动 = url-test,interval=300,timeout=5,tolerance=50,select=0,policy-regex-filter=^(?=.*(?i)(?:香港|港|🇭🇰|HK|Hong Kong|HKG|沪港|深港|Kowloon|Victoria))(?!.*(?i)(?:美|🇺🇸|US|台|�🇹🇼|TW|日|🇯🇵|JP|新|🇸🇬|SG|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
🇹🇼 台湾自动 = url-test,interval=300,timeout=5,tolerance=50,select=0,policy-regex-filter=^(?=.*(?i)(?:台湾|台|🇹🇼|TW|TPE|KHH|Taiwan|新北|彰化|台北|Taipei|高雄|Kaohsiung|Taichung|台中))(?!.*(?i)(?:美|🇺🇸|US|港|🇭🇰|HK|日|🇯🇵|JP|新|🇸🇬|SG|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
🇸🇬 新加坡自动 = url-test,interval=300,timeout=5,tolerance=50,select=0,policy-regex-filter=^(?=.*(?i)(?:新加坡|坡|狮城|🇸🇬|SG|SIN|Singapore|Changi|Marina Bay))(?!.*(?i)(?:美|🇺🇸|US|港|🇭🇰|HK|台|🇹🇼|TW|日|🇯🇵|JP|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
🇯🇵 日本自动 = url-test,interval=300,timeout=5,tolerance=50,select=0,policy-regex-filter=^(?=.*(?i)(?:日本|🇯🇵|JP|NRT|KIX|FUK|Japan|川日|东京|大阪|泉日|埼玉|名古屋|Nagoya|Kyoto|Okinawa))(?!.*(?i)(?:美|🇺🇸|US|港|🇭🇰|HK|台|🇹🇼|TW|新|🇸🇬|SG|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
🇺🇲 美国自动 = url-test,interval=300,timeout=5,tolerance=50,policy-regex-filter=^(?=.*(?i)(?:美|🇺🇸|US|USA|States|American|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|纽约|New York|Miami|Boston|United States|San Francisco))(?!.*(?i)(?:港|🇭🇰|HK|台|🇹🇼|TW|日|🇯🇵|JP|新|🇸🇬|SG|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
🌍 其他节点 = url-test,interval=300,timeout=5,tolerance=50,policy-regex-filter=^(?!.*(?i)(?:美|🇺🇸|US|日本|🇯🇵|JP|台湾|🇹🇼|TW|新加坡|🇸🇬|SG|香港|🇭🇰|HK|韩|🇰🇷|KR|专线|倍率|到期|过期|剩余|流量|时间|官网|产品)).*$
♻️ 自动选择 = url-test,interval=300,timeout=5,tolerance=50,policy-regex-filter=^(?!.*(?i)(?:专线|倍率|到期|过期|剩余|流量|时间|官网|产品|重新|重置|🪒 直连|总计|统计|建议|国内|海外)).*$

[Rule]
# 我自用规则
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/x.list ,🗽 x
RULE-SET,https://raw.githubusercontent.com/hiven425/hiven/refs/heads/master/config/ProxyLite.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/hiven425/hiven/refs/heads/master/config/AI.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/hiven425/hiven/refs/heads/master/config/Direct.list ,🎯 全球直连
RULE-SET,https://raw.githubusercontent.com/hiven425/hiven/refs/heads/master/config/wm.list ,🐬 外贸
# 基础分流
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/openai.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google-gemini.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.list ,📲 Telegram
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.list ,DIRECT
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.list ,DIRECT
# 社交媒体
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/facebook.list ,🐬 外贸
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/instagram.list ,🐬 外贸
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/linkedin.list ,🐬 外贸
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/whatsapp.list ,🐬 外贸
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.list ,🐬 外贸
# 增强规则集
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.list ,🚀 节点选择
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.list ,🚀 节点选择
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/greatfire.list ,🚀 节点选择
# 应用分流
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.list ,📹 YouTube
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.list ,🎥 Netflix
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple-cn.list ,🍎 Apple
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.list ,🍒 Microsoft
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/paypal.list ,💶 PayPal
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cloudflare.list ,☁️ Cloudflare
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.list ,🎵 Spotify
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/onedrive.list ,🚀 节点选择
# IP 规则
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.list ,🏹 AI
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.list ,📲 Telegram
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.list ,🎥 Netflix
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/facebook.list ,🐬 外贸
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cloudflare.list ,☁️ Cloudflare
# 引用远程规则集
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt ,🚀 节点选择
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt ,DIRECT
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/private.txt ,DIRECT
RULE-SET,https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.list ,DIRECT

# 兜底规则
GEOIP,CN,DIRECT
FINAL,🐟 漏网之鱼

[Host]
localhost = resolve

[URL Rewrite]
# Google 重定向
^https?://(www.)?g.cn https://www.google.com 302
^https?://(www.)?google.cn https://www.google.com 302
^https?:\/\/(ditu|maps).google\.cn https://maps.google.com 302

# ======= 油管视频广告请求 ======= #
(^https?:\/\/[\w-]+\.googlevideo\.com\/(?!dclk_video_ads).+?)&ctier=L(&.+?),ctier,(.+) $1$2$3 302 
^https?:\/\/[\w-]+\.googlevideo\.com\/(?!(dclk_video_ads|videoplayback\?)).+&oad - reject

[Module]
# 去广告模块
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Shadowrocket/Advertising/Advertising.sgmodule, tag=去广告重写, enabled=true
https://gist.githubusercontent.com/ddgksf2013/12ef6aad209155e7eb62c5b00c11b9dd/raw/StartUpAds.conf , tag=墨鱼去开屏2.0, enabled=true
# 功能增强
https://raw.githubusercontent.com/Maasea/sgmodule/master/YouTube.Enhance.sgmodule, tag=YouTube去广告, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/AdBlock/YoutubeAds.conf ,tag=油管去广告, enabled=true
https://raw.githubusercontent.com/app2smile/rules/master/module/spotify.module, tag=Spotify Premium, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/UnlockVip/Spotify.conf, tag=Spotify解锁, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/Function/GoogleVoice.conf, tag=Google Voice, enabled=true
https://github.com/VirgilClyne/iRingo/raw/main/sgmodule/Weather.sgmodule, tag=IOS天气服务, enabled=true
https://raw.githubusercontent.com/app2smile/rules/master/plugin/spotify.plugin, tag=Spotify歌词翻译, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/Html/EndlessGoogle.conf, tag=Google搜索优化, enabled=true
https://raw.githubusercontent.com/NobyDa/Script/master/QuantumultX/Snippet/GoogleCAPTCHA.snippet, tag=Google人机验证, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/Function/EmbyPlugin.conf, tag=Emby解锁, enabled=true
# 应用增强
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/AdBlock/Bilibili.conf, tag=Bilibili去广告, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/AdBlock/WeChat.conf, tag=微信公众号去广告, enabled=true
https://raw.githubusercontent.com/Semporia/TikTok-Unlock/master/Shadowrocket/TikTok.conf, tag=TikTok解锁, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Rewrite/master/Function/UnblockURLinWeChat.conf,tag=微信110解锁被屏蔽的URL	,enabled=true
https://raw.githubusercontent.com/id77/QuantumultX/master/rewrite/Youtube_CC.conf ,tag=Youtube无中文字幕机翻方案,enabled=true
[MITM]
enable = true
hostname = *.google.cn, *.google.com, *.googleapis.com, *.youtube.com, *.spotify.com, *.tiktokv.com, *.byteoversea.com, *.tik-tokapi.com, *.musical.ly, *.snssdk.com, *.amemv.com, *.bilibili.com, *.weixin.qq.com, mp.weixin.qq.com, *.googlevideo.com, youtubei.googleapis.com, *.tiktokcdn.com, *.douyin.com, weather-data.apple.com, weather-map.apple.com, api.weather.com, spclient.wg.spotify.com, www.google.*, recaptcha.net, mb3admin.com, *.emby.*, *.talkatone.com, api.waqi.info, www.weatherol.cn, api.caiyunapp.com, api.weatherol.cn

[Script]
# YouTube 去广告
youtube_ad = type=http-response, pattern=^https?:\/\/[\w-]+\.youtube\.com\/youtubei\/v1\/player, requires-body=1, max-size=-1, script-path=https://raw.githubusercontent.com/hiven425/hiven/master/config/youtube-adblock.js
# Spotify Premium
spotify-proto = type=http-response,pattern=^https:\/\/spclient\.wg\.spotify\.com\/(bootstrap\/v1\/bootstrap|user-customization-service\/v1\/customize)$,requires-body=1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-proto.js
# Spotify歌词翻译
spotify-lyrics = type=http-response,pattern=^https:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/,requires-body=1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-lyric.js
# Emby解锁
emby-unlock = type=http-response,pattern=^https?:\/\/mb3admin.com\/admin\/service\/registration\/validateDevice,requires-body=1,script-path=https://raw.githubusercontent.com/ddgksf2013/Scripts/master/EmbyPremiere.js
# IOS天气服务
weather-location = type=http-request,pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather.*,requires-body=0,script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.request.js
weather-response = type=http-response,pattern=^https?:\/\/weather-data\.apple\.com\/(v1|v2)\/weather.*,requires-body=1,script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Weather.response.js
# Google Voice
googlevoice = type=http-response,pattern=^https?:\/\/voice\.google\.com\/u\/0\/signup\/v2\/mobilewelcome,requires-body=1,script-path=https://raw.githubusercontent.com/ddgksf2013/Scripts/master/googlevoice.js
